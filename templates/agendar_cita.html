<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendar Cita | Clínica Dental John Vega</title>
 
    <link rel="stylesheet" href="/Static/CSS/estilos.css">
    <link rel="stylesheet" href="/Static/CSS/citas.css">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;700&display=swap" rel="stylesheet">

</head>

<body>

   <div id="navbar"></div>
    <script src="/Static/JS/include.js"></script>
    <script src="/Static/JS/navbar_auth.js"></script>

    <!-- SECCIÓN AGENDAR CITA -->
    <section class="agendar seccion-generica animate-on-load">

        <h2 class="animate-delay-1">Agenda tu cita</h2>

        <form id="formCita" class="animate-delay-2">

            <label>Nombre completo:</label>
            <input type="text" name="nombre" required>

            <label>Correo electrónico:</label>
            <input type="email" name="correo" required>

            <label>Teléfono:</label>
            <input type="tel" name="telefono" required>

            <label>Servicio:</label>
            <select name="servicio" required>
                <option value="">Seleccione un servicio</option>
                <option>Odontología General</option>
                <option>Ortodoncia</option>
                <option>Odontopediatría</option>
                <option>Endodoncia</option>
                <option>Cirugía Oral y Maxilofacial</option>
                <option>Periodoncia</option>
                <option>Rehabilitación oral y prótesis</option>
                <option>Estética Dental</option>
            </select>

            <label>Fecha deseada:</label>
            <input type="date" name="fecha" required>

            <button type="submit" class="btn-servicio">Enviar por WhatsApp</button>
        </form>

        <p id="mensaje-exito" class="mensaje-exito">¡Solicitud enviada con éxito por WhatsApp!</p>

    </section>

    <!-- SCRIPT WHATSAPP -->
    <script>
        document.getElementById('formCita').addEventListener('submit', async function (event) {
            event.preventDefault();

            const data = {
                nombre: this.nombre.value,
                correo: this.correo.value,
                telefono: this.telefono.value,
                servicio: this.servicio.value,
                fecha: this.fecha.value
            };

            try {
                // 1️⃣ Guardar en la base de datos
                await fetch("http://localhost:3000/citas-publicas", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                // 2️⃣ Abrir WhatsApp
                const numero = "50683611091";
                const mensaje = `Buenas, mi nombre es ${data.nombre}.
    Quisiera agendar una cita.
    
    Correo: ${data.correo}
    Teléfono: ${data.telefono}
    Servicio: ${data.servicio}
    Fecha deseada: ${data.fecha}`;

                const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;
                window.open(url, "_blank");

                alert(
                    "Solicitud enviada correctamente.\n\n" +
                    "Tu cita ha sido registrada y pronto será confirmada."
                );

                document.getElementById('mensaje-exito').style.display = 'block';
                this.reset();

            } catch (error) {
                console.error("Error:", error);
                alert("Ocurrió un error al registrar la cita");
            }
        });
    </script>

</body>

<footer class="footer-principal animate-on-load animate-delay-11">
        <div class="footer-contenido">
            <p>&copy; 2025 Clínica Dental Especializada John Vega. Todos los derechos reservados.</p>
            <div class="redes-sociales">
                <a href="https://www.facebook.com/profile.php?id=100069438113222" target="_blank"
                    rel="noopener noreferrer">
                    Facebook
                </a>
                <a href="https://wa.me/50683611091" target="_blank" rel="noopener noreferrer">
                    WhatsApp
                </a>
            </div>
        </div>
    </footer>

</html>